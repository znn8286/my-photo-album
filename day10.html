<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Day 10ï½œç·šä¸Šç›¸ç°¿ - RWD æ”¹å–„ & å¯è®€æ€§å„ªåŒ–</title>
  <!--
    èªªæ˜ï¼š
    - å–®ä¸€ HTML æª”ï¼Œç›´æ¥å­˜æˆ index.html é–‹å•Ÿå³å¯ã€‚
    - åœ¨ Day 9 çš„åŸºç¤ä¸Šåš RWD èˆ‡å¯è®€æ€§å„ªåŒ–ï¼š
      * æ’ç‰ˆï¼šä½¿ç”¨ clamp() éŸ¿æ‡‰å¼å­—ç´šã€è¼ƒå¤§çš„è¡Œé«˜èˆ‡é–“è·ã€å¡ç‰‡å…§é‚Šè·èª¿æ•´ã€‚
      * RWDï¼šæ¡Œæ©Ÿ 4 æ¬„ â†’ å¹³æ¿ 2â€“3 æ¬„ â†’ æ‰‹æ©Ÿ 1 æ¬„ï¼›å·¥å…·åˆ—åœ¨å°è¢å¹•è‡ªå‹•æ›è¡Œã€‚
      * å¯è¿‘ç”¨æ€§ï¼šæ›´æ˜é¡¯çš„ :focus-visible æ¨£å¼ã€æŒ‰éˆ•è§¸æ§é¢ 40px+ã€‚
      * ä¸»é¡Œï¼šåŠ å…¥ prefers-color-scheme æ·±è‰²æ¨¡å¼ï¼ˆCSS è®Šæ•¸ï¼‰ã€‚
      * å‹•ç•«ï¼šå°Šé‡ prefers-reduced-motionï¼Œæ¸›å°‘å‹•ç•«ã€‚
  -->
  <style>
    /* ===== è‰²ç¥¨èˆ‡ä¸»é¡Œï¼ˆæ·ºè‰² / æ·±è‰²ï¼‰ ===== */
    :root {
      --bg: #ffffff;
      --text: #1f2328;
      --muted: #6b7280;
      --primary: #ff8c42;
      --border: #e5e7eb;
      --card: #f9fafb;
      --shadow: rgba(0,0,0,0.06);
      --overlay: rgba(0,0,0,0.5);
      --focus: #2563eb;

      --radius: 12px;
      --container: 1200px;

      /* éŸ¿æ‡‰å¼å­—ç´š */
      --fs-xs: clamp(12px, 1.1vw, 13px);
      --fs-sm: clamp(13px, 1.2vw, 14px);
      --fs-md: clamp(14px, 1.4vw, 16px);
      --fs-lg: clamp(16px, 1.6vw, 18px);
      --fs-xl: clamp(18px, 2vw, 22px);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --primary: #ff954f;
        --border: #1f2937;
        --card: #0f172a;
        --shadow: rgba(0,0,0,0.4);
        --overlay: rgba(0,0,0,0.6);
        --focus: #60a5fa;
      }
    }

    /* å…¨åŸŸæ’ç‰ˆèˆ‡å¯è®€æ€§ */
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans CJK TC", "Microsoft JhengHei", Helvetica, Arial, sans-serif;
      font-size: var(--fs-md); line-height: 1.65; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }
    .container { max-width: var(--container); margin: 0 auto; padding: 24px; box-sizing: border-box; }

    /* ç„¦é»å¯è¦‹æ¨£å¼ï¼ˆéµç›¤å°è¦½ï¼‰ */
    :where(a, button, input, select, textarea) { outline: none; }
    :where(a, button, input, select, textarea):focus-visible {
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--focus) 50%, transparent), 0 0 0 1.5px var(--focus) inset;
      border-radius: 10px;
    }

    /* é€£çµã€æŒ‰éˆ•è§¸æ§é¢ï¼ˆè‡³å°‘ 40px é«˜ï¼‰ */
    button, .btn-like { min-height: 40px; }

    /* ===== é é¦– ===== */
    header.site-header { border-bottom: 1px solid var(--border); background: linear-gradient(180deg, #fff, #fff7f1); }
    @media (prefers-color-scheme: dark) {
      header.site-header { background: linear-gradient(180deg, #0b1220, #0b1220); }
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .brand__logo { width: 44px; height: 44px; border-radius: 10px; background: var(--primary); display: inline-flex; align-items: center; justify-content: center; color: #fff; font-weight: 800; font-size: var(--fs-lg); }
    .brand__title { margin: 0; font-size: var(--fs-xl); }
    .brand__subtitle { margin: 4px 0 0; color: var(--muted); font-size: var(--fs-sm); }

    /* ===== å·¥å…·åˆ—ï¼ˆè‡ªé©æ‡‰æ›è¡Œï¼‰ ===== */
    .toolbar { display: grid; gap: 12px; margin-top: 16px; align-items: center; }
    /* æ¡Œæ©Ÿï¼š5 æ¬„ï¼ˆæœå°‹ã€æª”æ¡ˆã€åˆ†é¡ã€æ’åºã€é †åºã€é æ•¸ï¼‰ */
    .toolbar { grid-template-columns: 1fr 260px 160px 160px 140px 140px; }
    /* å¹³æ¿ï¼š3 æ¬„ */
    @media (max-width: 990px) { .toolbar { grid-template-columns: 1fr 1fr 1fr; } }
    /* æ‰‹æ©Ÿï¼š1 æ¬„å †ç–Š */
    @media (max-width: 640px) { .toolbar { grid-template-columns: 1fr; } }

    .toolbar input[type="text"], .toolbar select, .toolbar button {
      padding: 10px 12px; border: 1px solid var(--border); border-radius: 10px; background: #fff; font-size: var(--fs-sm);
      background: color-mix(in srgb, var(--card) 96%, var(--bg)); color: var(--text);
    }
    .toolbar input[type="file"] { padding: 8px; border: 1px solid var(--border); border-radius: 10px; background: #fff; font-size: var(--fs-sm); }
    .toolbar .btn { background: var(--primary); color: #fff; border: none; cursor: pointer; border-radius: 10px; padding: 10px 12px; font-weight: 600; }

    /* ===== å…§å®¹å€ï¼šRWD ç¶²æ ¼ ===== */
    main.gallery { margin-top: 18px; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(4, 1fr); }
    @media (max-width: 1200px) { .grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 990px) { .grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px) { .grid { grid-template-columns: 1fr; } }

    /* ===== å¡ç‰‡ ===== */
    .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: 0 2px 8px var(--shadow); overflow: hidden; display: flex; flex-direction: column; }
    .thumb { aspect-ratio: 4 / 3; background: #eef2f7; position: relative; display: flex; align-items: center; justify-content: center; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .meta { padding: 12px; display: grid; grid-template-rows: auto auto auto; gap: 8px; }
    .title-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .title { font-size: var(--fs-md); font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .time { font-size: var(--fs-xs); color: var(--muted); }
    .tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .tag { font-size: 11px; padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); background: color-mix(in srgb, var(--bg) 70%, #fff); }
    .btn { padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #fff; cursor: pointer; font-size: var(--fs-sm); }
    .btn.edit { background: var(--primary); color: #fff; border: none; }

    /* ç‹€æ…‹åˆ—èˆ‡ç©ºç‹€æ…‹ */
    .statusbar { display:flex; align-items:center; justify-content: space-between; margin: 8px 0 12px; color: var(--muted); font-size: var(--fs-sm); }
    .empty { border: 2px dashed var(--border); border-radius: var(--radius); padding: 24px; color: var(--muted); display:flex; align-items:center; justify-content:center; grid-column: 1 / -1; background:#fff0; }

    /* åˆ†é æ¢ */
    .pager { display:flex; align-items:center; justify-content:center; gap:12px; margin-top:16px; }
    .pager .btn { background: var(--primary); color:#fff; border:none; border-radius: 12px; padding: 12px 18px; cursor:pointer; font-weight:700; }
    .pager .btn[disabled]{ opacity:.55; cursor:not-allowed }
    .pager .hint{ color:var(--muted); font-size: var(--fs-sm); }

    /* ===== Modal ===== */
    .modal-backdrop { position: fixed; inset: 0; background: var(--overlay); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 16px; }
    .modal { width: 560px; max-width: 720px; background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,.15); overflow: hidden; }
    .modal__header { padding: 14px 16px; border-bottom: 1px solid var(--border); font-weight: 800; font-size: var(--fs-lg); }
    .modal__body { padding: 16px; display: grid; gap: 12px; }
    .modal__footer { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }
    .field { display: grid; gap: 6px; }
    .field label { font-size: var(--fs-sm); color: var(--muted); }
    .field input[type="text"], .field textarea, .field select { width: 100%; box-sizing: border-box; padding: 12px 12px; border: 1px solid var(--border); border-radius: 10px; font-size: var(--fs-md); background: color-mix(in srgb, var(--card) 96%, var(--bg)); color: var(--text); }
    .field textarea { resize: vertical; min-height: 90px; }
    .btn.secondary { background: #fff0; border: 1px solid var(--border); color: var(--text); }
    .btn.primary { background: var(--primary); color: #fff; border: none; }

    /* å®‰å…¨å€ï¼ˆiOS ç€æµ·ï¼‰ */
    @supports (padding: max(0px)) {
      body { padding-bottom: max(0px, env(safe-area-inset-bottom)); }
    }

    /* å‹•ç•«åå¥½ï¼šæ¸›å°‘ç§»å‹• */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>
  <!-- ====== é é¦– ====== -->
  <header class="site-header">
    <div class="container">
      <div class="brand">
        <div class="brand__logo" aria-hidden="true">PA</div>
        <div>
          <h1 class="brand__title">ç·šä¸Šç›¸ç°¿ï¼ˆDay 10ï¼‰</h1>
          <p class="brand__subtitle">RWD æ”¹å–„ & å¯è®€æ€§å„ªåŒ–ï¼šå­—ç´š/é–“è·/è¡Œé«˜/æŒ‰éˆ•å¯é»å€/æ·±è‰²æ¨¡å¼</p>
        </div>
      </div>

      <div class="toolbar" role="region" aria-label="å·¥å…·åˆ—">
        <input id="searchInput" type="text" placeholder="æœå°‹é—œéµå­—ï¼ˆæ¨™é¡Œï¼æ•˜è¿°ï¼æ¨™ç±¤ï¼æª”åï¼‰" aria-label="æœå°‹">
        <input id="fileInput" type="file" accept="image/*" multiple aria-label="ä¸Šå‚³åœ–ç‰‡">
        <select id="categorySelect" aria-label="åˆ†é¡"></select>
        <select id="sortBy" aria-label="æ’åºä¾æ“š">
          <option value="time" selected>ä¾æ™‚é–“</option>
          <option value="title">ä¾æ¨™é¡Œ</option>
        </select>
        <select id="sortOrder" aria-label="å‡å†ªæˆ–é™å†ª">
          <option value="desc" selected>é™å†ª</option>
          <option value="asc">å‡å†ª</option>
        </select>
        <select id="pageSize" aria-label="æ¯é ç­†æ•¸">
          <option value="8">æ¯é  8 å¼µ</option>
          <option value="12" selected>æ¯é  12 å¼µ</option>
          <option value="16">æ¯é  16 å¼µ</option>
          <option value="24">æ¯é  24 å¼µ</option>
        </select>
        <div style="grid-column: 1 / -1; font-size: var(--fs-sm); color:var(--muted);">
          æç¤ºï¼šå·¥å…·åˆ—åœ¨çª„è¢å¹•æœƒè‡ªå‹•æ›è¡Œï¼›å¡ç‰‡ç¶²æ ¼æœƒå¾ 4 æ¬„é€æ­¥ç¸®åˆ° 1 æ¬„ã€‚
        </div>
      </div>
    </div>
  </header>

  <!-- ====== å…§å®¹ ====== -->
  <main class="gallery">
    <div class="container">
      <div class="statusbar" aria-live="polite">
        <div><span id="countAll">0</span> å¼µç…§ç‰‡</div>
        <div>å·²é¡¯ç¤ºï¼š<span id="countShown">0</span>ï¼ç¬¦åˆï¼š<span id="countFiltered">0</span> å¼µ</div>
      </div>
      <div style="display:flex; justify-content:flex-end; gap:8px; margin-bottom:8px;">
        <button id="clearBtn" class="btn secondary" type="button" title="æ¸…ç©ºå…¨éƒ¨è³‡æ–™">æ¸…ç©ºå…¨éƒ¨</button>
      </div>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div class="pager">
        <button id="loadMoreBtn" class="btn" type="button">è¼‰å…¥æ›´å¤š</button>
        <span class="hint" id="pagerHint"></span>
      </div>
    </div>
  </main>

  <!-- ====== Modalï¼šç·¨è¼¯åœ–ç‰‡ä¸­ç¹¼è³‡æ–™ ====== -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <div class="modal__header" id="modalTitle">ç·¨è¼¯åœ–ç‰‡è³‡è¨Š</div>
      <div class="modal__body">
        <div class="field">
          <label for="fTitle">æ¨™é¡Œ</label>
          <input id="fTitle" type="text" placeholder="ä¾‹ï¼šå°åŒ—å°æ—…è¡Œ" />
        </div>
        <div class="field">
          <label for="fDesc">æ•˜è¿°</label>
          <textarea id="fDesc" placeholder="ç°¡çŸ­æè¿°é€™å¼µç…§ç‰‡...ï¼ˆéå¿…å¡«ï¼‰"></textarea>
        </div>
        <div class="field">
          <label for="fTags">æ¨™ç±¤ï¼ˆä»¥é€—è™Ÿ , åˆ†éš”ï¼‰</label>
          <input id="fTags" type="text" placeholder="ä¾‹ï¼šæ—…éŠ, æœ‹å‹, æ™šä¸Š" />
        </div>
        <div class="field">
          <label for="fCategory">åˆ†é¡</label>
          <input id="fCategory" list="catList" type="text" placeholder="ä¾‹ï¼šæ—…éŠ / ç”Ÿæ´» / å¯µç‰©" />
          <datalist id="catList"></datalist>
        </div>
      </div>
      <div class="modal__footer">
        <button id="btnCancel" class="btn secondary" type="button">å–æ¶ˆ</button>
        <button id="btnSave" class="btn primary" type="button">å„²å­˜</button>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container" style="border-top:1px solid var(--border); margin-top:24px; padding-top:16px; color:var(--muted); font-size: var(--fs-sm); text-align:center;">
      Day 10 å®Œæˆï¼šRWD + å¯è®€æ€§å„ªåŒ–ã€‚æ·±è‰²æ¨¡å¼è·Ÿéš¨ç³»çµ±ï¼›éµç›¤å°è¦½æœ‰æ¸…æ¥šçš„ç„¦é»æ¡†ã€‚
    </div>
  </footer>

  <script>
    // ============================
    // Day 10ï¼šRWD & å¯è®€æ€§ï¼ˆåœ¨ Day 9 åŸºç¤ä¸Šï¼‰
    // ============================
    const LS_KEY = 'pa_photos_v1';

    // å·¥å…·åˆ—
    const fileInput = document.getElementById('fileInput');
    const searchInput = document.getElementById('searchInput');
    const categorySelect = document.getElementById('categorySelect');
    const sortBySelect = document.getElementById('sortBy');
    const sortOrderSelect = document.getElementById('sortOrder');
    const pageSizeSelect = document.getElementById('pageSize');

    // å…§å®¹ & ç‹€æ…‹
    const grid = document.getElementById('grid');
    const clearBtn = document.getElementById('clearBtn');
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    const pagerHint = document.getElementById('pagerHint');

    const countAll = document.getElementById('countAll');
    const countFiltered = document.getElementById('countFiltered');
    const countShown = document.getElementById('countShown');

    // Modal
    const modalBackdrop = document.getElementById('modalBackdrop');
    const fTitle = document.getElementById('fTitle');
    const fDesc = document.getElementById('fDesc');
    const fTags = document.getElementById('fTags');
    const fCategory = document.getElementById('fCategory');
    const catList = document.getElementById('catList');
    const btnCancel = document.getElementById('btnCancel');
    const btnSave = document.getElementById('btnSave');

    /** @type {{ id:string, dataUrl:string, name:string, lastModified:number, size:number, title:string, desc:string, tags:string[], category?:string }[]} */
    let photos = [];
    let editingId = null;
    let query = '';
    let currentCategory = 'å…¨éƒ¨';
    let sortBy = 'time';
    let sortOrder = 'desc';
    let pageSize = 12;
    let visibleCount = pageSize; // å·²é¡¯ç¤ºå¼µæ•¸

    const DEFAULT_CAT = 'æœªåˆ†é¡';

    function uid(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}
    function prettySize(bytes){const u=['B','KB','MB','GB'];let i=0,n=bytes;while(n>=1024&&i<u.length-1){n/=1024;i++}return `${n.toFixed(1)} ${u[i]}`}
    function fileNameWithoutExt(name=''){const i=name.lastIndexOf('.');return i>0?name.slice(0,i):name||'æœªå‘½ååœ–ç‰‡'}

    function safeGetLS(key){try{return localStorage.getItem(key)}catch(e){console.warn('è®€å– LS å¤±æ•—',e);return null}}
    function safeSetLS(key,val){try{localStorage.setItem(key,val);return true}catch(e){alert('å„²å­˜å¤±æ•—ï¼Œå¯èƒ½è¶…é LocalStorage å®¹é‡ã€‚');console.warn('å¯«å…¥ LS å¤±æ•—',e);return false}}
    function saveToStorage(){return safeSetLS(LS_KEY, JSON.stringify(photos))}
    function loadFromStorage(){const raw=safeGetLS(LS_KEY);if(!raw) return [];try{const arr=JSON.parse(raw);if(Array.isArray(arr))return arr}catch(e){console.warn('è§£æ JSON å¤±æ•—',e)}return []}

    // åˆ†é¡
    function getAllCategories(){const set=new Set();photos.forEach(p=>set.add((p.category&&p.category.trim())||DEFAULT_CAT));set.add(DEFAULT_CAT);return Array.from(set).sort((a,b)=>a.localeCompare(b))}
    function buildCategorySelect(){const cats=getAllCategories();const prev=currentCategory;categorySelect.innerHTML='';categorySelect.appendChild(new Option('å…¨éƒ¨','å…¨éƒ¨'));cats.forEach(c=>categorySelect.appendChild(new Option(c,c)));categorySelect.value=(cats.includes(prev)||prev==='å…¨éƒ¨')?prev:'å…¨éƒ¨';currentCategory=categorySelect.value}
    function buildCategoryDatalist(){const cats=getAllCategories();catList.innerHTML='';cats.forEach(c=>{const opt=document.createElement('option');opt.value=c;catList.appendChild(opt)})}

    // æœå°‹ + åˆ†é¡
    function baseFilter(list){
      const q=(query||'').trim().toLowerCase();
      const tokens=q?q.split(/\s+/).filter(Boolean):[];
      return list.filter(p=>{
        const cat=(p.category&&p.category.trim())||DEFAULT_CAT;
        if(currentCategory!=='å…¨éƒ¨' && cat!==currentCategory) return false;
        if(!tokens.length) return true;
        const hay=[p.title||'',p.desc||'',(p.tags||[]).join(' '),p.name||''].join(' ').toLowerCase();
        return tokens.every(tok=>hay.includes(tok));
      })
    }

    // æ’åº
    function sortPhotos(list){
      const arr=list.slice();
      const order = sortOrder==='asc'?1:-1;
      if(sortBy==='time'){
        arr.sort((a,b)=>{const t1=Number(a.lastModified||0),t2=Number(b.lastModified||0);return (t1===t2?0:(t1>t2?1:-1))*order})
      }else{ // title
        arr.sort((a,b)=>{const s1=(a.title||fileNameWithoutExt(a.name)).toLowerCase();const s2=(b.title||fileNameWithoutExt(b.name)).toLowerCase();if(s1===s2) return 0;return (s1>s2?1:-1)*order})
      }
      return arr
    }

    function getFilteredSorted(){return sortPhotos(baseFilter(photos))}
    function getVisibleData(){return getFilteredSorted().slice(0, visibleCount)}

    function updatePagerUI(total){
      const shown = Math.min(visibleCount, total);
      countAll.textContent=String(photos.length);
      countFiltered.textContent=String(total);
      countShown.textContent=String(shown);
      const hasMore = shown < total;
      loadMoreBtn.disabled = !hasMore;
      pagerHint.textContent = hasMore ? `å°šæœ‰ ${total - shown} å¼µæœªé¡¯ç¤º` : (total===0 ? 'æ²’æœ‰ç¬¦åˆçš„ç›¸ç‰‡' : 'å·²é¡¯ç¤ºå…¨éƒ¨');
    }

    // æ¸²æŸ“
    function render(){
      const data = getVisibleData();
      const total = getFilteredSorted().length; // ç¸½ç¬¦åˆæ•¸
      updatePagerUI(total);

      const frag=document.createDocumentFragment();
      if(data.length===0){
        const empty=document.createElement('div'); empty.className='empty';
        empty.textContent = (photos.length===0)?'é‚„æ²’æœ‰ç›¸ç‰‡ï¼Œè«‹å¾ä¸Šæ–¹ä¸Šå‚³ã€‚':'æ²’æœ‰ç¬¦åˆç›®å‰æœå°‹/åˆ†é¡çš„çµæœã€‚';
        frag.appendChild(empty);
      }else{
        data.forEach(p=>{
          const card=document.createElement('article'); card.className='card'; card.dataset.id=p.id;
          const thumb=document.createElement('div'); thumb.className='thumb';
          const img=document.createElement('img'); img.src=p.dataUrl; img.alt=p.title||p.name; thumb.appendChild(img);
          const meta=document.createElement('div'); meta.className='meta';
          const titleRow=document.createElement('div'); titleRow.className='title-row';
          const title=document.createElement('div'); title.className='title'; title.textContent=p.title||fileNameWithoutExt(p.name);
          const editBtn=document.createElement('button'); editBtn.className='btn edit'; editBtn.type='button'; editBtn.textContent='ç·¨è¼¯'; editBtn.addEventListener('click',()=>openEditor(p.id));
          titleRow.appendChild(title); titleRow.appendChild(editBtn);
          const time=document.createElement('div'); time.className='time'; const dt=new Date(p.lastModified||Date.now());
          const cat=(p.category&&p.category.trim())||DEFAULT_CAT;
          time.textContent=`${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}-${String(dt.getDate()).padStart(2,'0')} ${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}ï½œ${prettySize(p.size||0)}ï½œåˆ†é¡ï¼š${cat}`;
          const tagsWrap=document.createElement('div'); tagsWrap.className='tags'; (p.tags||[]).filter(Boolean).forEach(t=>{const chip=document.createElement('span'); chip.className='tag'; chip.textContent=t; tagsWrap.appendChild(chip)});
          meta.appendChild(titleRow); meta.appendChild(time); meta.appendChild(tagsWrap);
          card.appendChild(thumb); card.appendChild(meta); frag.appendChild(card);
        })
      }
      grid.innerHTML=''; grid.appendChild(frag);
    }

    // è®€æª”ç‚º DataURL
    function readFileAsDataURL(file){return new Promise((resolve,reject)=>{const r=new FileReader();r.onerror=()=>reject(new Error('è®€æª”å¤±æ•—'));r.onload=()=>resolve(r.result);r.readAsDataURL(file)})}

    // äº‹ä»¶ï¼šä¸Šå‚³
    fileInput.addEventListener('change', async (e)=>{
      const files=Array.from(e.target.files||[]); if(!files.length) return;
      const images=files.filter(f=>f.type&&f.type.startsWith('image/'));
      const nonImages=files.filter(f=>!f.type||!f.type.startsWith('image/'));
      if(nonImages.length) alert('å·²ç•¥ééåœ–ç‰‡æª”æ¡ˆï¼š\n'+nonImages.map(f=>'â€¢ '+f.name).join('\n'));
      for(const file of images){
        try{ const dataUrl=await readFileAsDataURL(file);
          photos.push({id:uid(),dataUrl:String(dataUrl),name:file.name,lastModified:file.lastModified,size:file.size,title:fileNameWithoutExt(file.name),desc:'',tags:[],category:DEFAULT_CAT});
        }catch(err){ console.warn('è½‰æ› DataURL å¤±æ•—ï¼š',err) }
      }
      saveToStorage(); buildCategorySelect(); buildCategoryDatalist(); visibleCount = pageSize; render(); fileInput.value='';
    })

    // äº‹ä»¶ï¼šæ¸…ç©º
    clearBtn.addEventListener('click',()=>{ if(!photos.length) return; if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å·²å„²å­˜çš„ç›¸ç‰‡èˆ‡è³‡æ–™å—ï¼Ÿæ­¤å‹•ä½œä¸å¯å›å¾©ã€‚')){ photos=[]; saveToStorage(); buildCategorySelect(); buildCategoryDatalist(); visibleCount=pageSize; render(); } })

    // äº‹ä»¶ï¼šæœå°‹ / åˆ†é¡ / æ’åº / æ¯é ç­†æ•¸
    searchInput.addEventListener('input',e=>{ query=e.target.value||''; visibleCount=pageSize; render() })
    categorySelect.addEventListener('change',e=>{ currentCategory=e.target.value; visibleCount=pageSize; render() })
    sortBySelect.addEventListener('change',e=>{ sortBy=e.target.value; visibleCount=pageSize; render() })
    sortOrderSelect.addEventListener('change',e=>{ sortOrder=e.target.value; visibleCount=pageSize; render() })
    pageSizeSelect.addEventListener('change',e=>{ pageSize=Number(e.target.value)||12; visibleCount=pageSize; render() })

    // äº‹ä»¶ï¼šè¼‰å…¥æ›´å¤š
    loadMoreBtn.addEventListener('click',()=>{ const total=getFilteredSorted().length; visibleCount=Math.min(visibleCount+pageSize, total); render() })

    // ç·¨è¼¯å½ˆçª—
    function openEditor(id){ const p=photos.find(x=>x.id===id); if(!p) return; editingId=id; fTitle.value=p.title||fileNameWithoutExt(p.name); fDesc.value=p.desc||''; fTags.value=(p.tags||[]).join(', '); fCategory.value=(p.category&&p.category.trim())||DEFAULT_CAT; showModal(true); setTimeout(()=>fTitle.focus(),0) }
    function showModal(show){ modalBackdrop.style.display=show?'flex':'none'; modalBackdrop.setAttribute('aria-hidden',show?'false':'true'); if(!show) editingId=null }
    function saveEditor(){ const p=photos.find(x=>x.id===editingId); if(!p) return; p.title=fTitle.value.trim(); p.desc=fDesc.value.trim(); p.tags=fTags.value.split(',').map(s=>s.trim()).filter(Boolean); p.category=(fCategory.value||'').trim()||DEFAULT_CAT; saveToStorage(); buildCategorySelect(); buildCategoryDatalist(); render(); showModal(false) }
    btnCancel.addEventListener('click',()=>showModal(false))
    btnSave.addEventListener('click',saveEditor)
    document.addEventListener('keydown',ev=>{ if(modalBackdrop.style.display==='flex' && ev.key==='Escape') showModal(false) })
    modalBackdrop.addEventListener('click',ev=>{ if(ev.target===modalBackdrop) showModal(false) })

    // ============================
    // è¼•é‡è‡ªæˆ‘æ¸¬è©¦ï¼ˆconsoleï¼‰â€” é‡å°æ’åº/åˆ†é å‡½å¼ï¼›UI RWD ä»¥äººå·¥æª¢è¦–ç‚ºä¸»
    // ============================
    function runSelfTests(){
      console.groupCollapsed('ğŸ” Self-tests for Day 10');
      try{
        const mock=[
          {id:'1',name:'b.jpg',title:'Bravo',lastModified:1000},
          {id:'2',name:'a.jpg',title:'Alpha',lastModified:2000},
          {id:'3',name:'c.jpg',title:'Charlie',lastModified:1500},
          {id:'4',name:'d.jpg',title:'Delta',lastModified:1200}
        ];
        const prevPhotos = photos; // ä¸æ±¡æŸ“å¯¦éš›è³‡æ–™
        photos = mock.map(x=>({...x,dataUrl:'',size:0,desc:'',tags:[],category:DEFAULT_CAT}));
        sortBy='time'; sortOrder='desc'; pageSize=2; visibleCount=2;
        let all = getFilteredSorted();
        console.assert(all.map(x=>x.lastModified).join(',')==='2000,1500,1200,1000','æ™‚é–“é™å†ªæ’åºæ‡‰ç‚º 2000,1500,1200,1000');
        let page = getVisibleData();
        console.assert(page.length===2 && page[0].lastModified===2000 && page[1].lastModified===1500,'ç¬¬ä¸€é æ‡‰ç‚º 2000,1500');
        visibleCount += pageSize; page = getVisibleData();
        console.assert(page.length===4 && page[3].lastModified===1000,'ç¬¬äºŒæ‰¹æ‡‰èƒ½çœ‹åˆ° 1000');
        // æ¨™é¡Œæ’åº + å‡å†ª
        sortBy='title'; sortOrder='asc'; visibleCount=3; page = getVisibleData();
        console.assert(page.map(x=>x.title.toLowerCase()).join(',')==='alpha,bravo,charlie','æ¨™é¡Œå‡å†ªå‰ä¸‰ç­†æ‡‰ç‚º alpha,bravo,charlie');
        photos = prevPhotos; // é‚„åŸ
        console.log('âœ… è‡ªæˆ‘æ¸¬è©¦é€šé');
      }catch(err){ console.error('âŒ è‡ªæˆ‘æ¸¬è©¦å¤±æ•—',err) }
      console.groupEnd();
    }

    // åˆå§‹åŒ–
    (function init(){
      photos = loadFromStorage();
      // èˆŠè³‡æ–™è£œä¸Š category
      let patched=false; photos.forEach(p=>{ if(!('category' in p)) { p.category=DEFAULT_CAT; patched=true } }); if(patched) saveToStorage();
      buildCategorySelect(); buildCategoryDatalist();
      sortBy = sortBySelect.value; sortOrder = sortOrderSelect.value; pageSize = Number(pageSizeSelect.value)||12; visibleCount = pageSize;
      render();
      runSelfTests();
      console.log('âœ… Day 10ï¼šRWD & å¯è®€æ€§å·²å•Ÿç”¨ã€‚ç…§ç‰‡æ•¸ï¼š', photos.length);
    })();
  </script>
</body>
</html>

